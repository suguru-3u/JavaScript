<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TodoApp</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <h1 id="todo-title">This is Todo App</h1>
    <div id="todo">
      <div id="todo-filed">
        <div id="todo-add">
          <input type="text" id="todo-value" />
          <button onclick="addTodo()">Add Todo</button>
        </div>
        <div>
          <ul id="todo-list"></ul>
        </div>
      </div>
      <div id="todo-filed-edit">
        <h1>Edit Todo</h1>
        <input type="text" id="edit-value" name="edit-number" />
        <button onclick="editTodo()">変更</button>
        <button onclick="hiddenTodoFiled()">キャンセル</button>
      </div>
    </div>
    <script>
      let todos = ["todo"];

      const readTodo = () => {
        const todoList = document.getElementById("todo-list");
        todos.forEach((todo, index) => {
          todoList.innerHTML += `<li>${todo}<button onclick="displayEditTodo(${index})">編集</button><button onclick="deleteTodo(${index})">削除</button></li>`;
        });
      };
      const clearTodoList = () => {
        document.getElementById("todo-list").innerHTML = "";
      };

      const addTodo = () => {
        todos = [...todos, document.getElementById("todo-value").value];
        document.getElementById("todo-value").value = "";
        clearTodoList();
        readTodo();
      };

      const editTodo = () => {
        const todoValue = document.getElementById("edit-value").value;
        const todoIndex = document.getElementById("edit-value").name;
        todos = todos.map((todo, index) => {
          if (index === parseInt(todoIndex)) {
            return todoValue;
          }
          return todo;
        });
        document.getElementById("edit-value").value = "";
        clearTodoList();
        readTodo();
        hiddenTodoFiled();
      };

      const deleteTodo = (todoIndex) => {
        todos = todos.filter((_, filterIndex) => filterIndex !== todoIndex);
        clearTodoList();
        readTodo();
      };

      const displayChange = (elementId, displayStyle) => {
        document.getElementById(elementId).style.display = displayStyle;
      };

      const hiddenTodoFiled = () => {
        displayChange("todo-filed-edit", "none");
        displayChange("todo-filed", "block");
      };

      const displayEditTodo = (index) => {
        displayChange("todo-filed-edit", "block");
        displayChange("todo-filed", "none");
        document.getElementById("edit-value").value = todos[index];
        document.getElementById("edit-value").name = index;
      };

      // 読み込み時の処理
      window.onload = readTodo();
    </script>
  </body>
</html>
